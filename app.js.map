{"version":3,"sources":["app.js"],"names":["angular","module","controller","$scope","$http","$element","page","sortBy","sortOptions","products","changeSort","find","scrollTop","getProducts","isLoading","get","then","response","data","concat","catch","console","log","error","nextPage","maxPage","processDate","date","minDate","Date","moment","subtract","calendar","format","fromNow","onInit","directive","restrict","link","scope","element","attrs","visibleHeight","height","threshold","scroll","event","scrollableHeight","prop","hiddenContentHeight","$apply","whenScrollEnds"],"mappings":";;AAAAA,QAAQC,MAAR,CAAe,MAAf,EAAuB,EAAvB,EAA2BC,UAA3B,CAAsC,WAAtC,EAAmD,CAAC,QAAD,EAAW,OAAX,EAAoB,UAApB,EAAgC,UAASC,MAAT,EAAiBC,KAAjB,EAAwBC,QAAxB,EAAkC;AACpHF,QAAOG,IAAP,GAAc,CAAd;AACAH,QAAOI,MAAP,GAAgB,MAAhB;AACAJ,QAAOK,WAAP,GAAqB,CAAC,MAAD,EAAS,OAAT,CAArB;AACAL,QAAOM,QAAP,GAAkB,EAAlB;;AAEAN,QAAOO,UAAP,GAAoB,YAAW;AAC9BP,SAAOG,IAAP,GAAc,CAAd;AACAD,WAASM,IAAT,CAAc,cAAd,EAA8BC,SAA9B,CAAwC,CAAxC;AACAT,SAAOM,QAAP,GAAkB,EAAlB;AAEA,EALD;;AAOAN,QAAOU,WAAP,GAAqB,YAAW;AAC/BV,SAAOW,SAAP,GAAmB,IAAnB;AACAV,QAAMW,GAAN,yBAAgCZ,OAAOG,IAAvC,gBAAsDH,OAAOI,MAA7D,EACES,IADF,CACO,oBAAY;AACjBb,UAAOc,QAAP,GAAkBA,SAASC,IAA3B;AACAf,UAAOM,QAAP,GAAkBN,OAAOM,QAAP,CAAgBU,MAAhB,CAAuBF,SAASC,IAAT,CAAcT,QAArC,CAAlB;AACAN,UAAOW,SAAP,GAAmB,KAAnB;AACA,GALF,EAMEM,KANF,CAMQ;AAAA,UAASC,QAAQC,GAAR,6BAAsCC,MAAML,IAA5C,CAAT;AAAA,GANR;AAOA,EATD;;AAWAf,QAAOqB,QAAP,GAAkB,YAAW;AAC5B,MAAIrB,OAAOG,IAAP,GAAcH,OAAOc,QAAP,CAAgBQ,OAAlC,EAA2C;AAC1CtB,UAAOG,IAAP;AACAH,UAAOU,WAAP;AACA;AAED,EAND;;AAQAV,QAAOuB,WAAP,GAAqB,UAASC,IAAT,EAAe;AACnC,MAAIC,UAAU,IAAIC,IAAJ,CAASC,SAASC,QAAT,CAAkB,CAAlB,EAAqB,MAArB,EAA6BC,QAA7B,EAAT,CAAd;AACA,SAAO,IAAIH,IAAJ,CAASF,IAAT,IAAiBC,OAAjB,GAA2BE,OAAOH,IAAP,EAAaM,MAAb,CAAoB,KAApB,CAA3B,GAAwDH,OAAOH,IAAP,EAAaO,OAAb,EAA/D;AACA,EAHD;;AAMA,UAASC,MAAT,GAAkB;AACjBhC,SAAOU,WAAP;AACA;;AAEDsB;AACA,CA3CkD,CAAnD;AA4CAnC,QAAQC,MAAR,CAAe,MAAf,EAAuBmC,SAAvB,CAAiC,gBAAjC,EAAmD,YAAW;AAC1D,QAAO;AACHC,YAAU,GADP;AAEHC,QAAM,cAASC,KAAT,EAAgBC,OAAhB,EAAyBC,KAAzB,EAAgC;AAClC,OAAIC,gBAAgBF,QAAQG,MAAR,EAApB;AAAA,OACIC,YAAY,CADhB;;AAGAJ,WAAQK,MAAR,CAAe,UAASC,KAAT,EAAgB;AAC3B,QAAIC,mBAAmBP,QAAQQ,IAAR,CAAa,cAAb,CAAvB;AACA,QAAIC,sBAAsBF,mBAAmBL,aAA7C;;AAEA,QAAIO,sBAAsBT,QAAQ5B,SAAR,EAAtB,IAA6CgC,SAAjD,EAA4D;AACxDL,WAAMW,MAAN,CAAaT,MAAMU,cAAnB;AACH;AACJ,IAPD;AAQH;AAdE,EAAP;AAgBH,CAjBD","file":"app.js","sourcesContent":["angular.module('test', []).controller('indexCtrl', ['$scope', '$http', '$element', function($scope, $http, $element) {\n\t$scope.page = 1;\n\t$scope.sortBy = 'size';\n\t$scope.sortOptions = ['size', 'price'];\n\t$scope.products = [];\n\n\t$scope.changeSort = function() {\n\t\t$scope.page = 0;\n\t\t$element.find(\".product-box\").scrollTop(0);\n\t\t$scope.products = [];\n\t\t\n\t};\n\n\t$scope.getProducts = function() {\n\t\t$scope.isLoading = true;\n\t\t$http.get(`/api/products?page=${$scope.page}&sortBy=${$scope.sortBy}`)\n\t\t\t.then(response => {\n\t\t\t\t$scope.response = response.data;\n\t\t\t\t$scope.products = $scope.products.concat(response.data.products);\n\t\t\t\t$scope.isLoading = false;\n\t\t\t})\n\t\t\t.catch(error => console.log(`Error getting products ${error.data}`));\n\t};\n\n\t$scope.nextPage = function() {\n\t\tif ($scope.page < $scope.response.maxPage) {\n\t\t\t$scope.page++;\n\t\t\t$scope.getProducts();\n\t\t}\n\n\t};\n\n\t$scope.processDate = function(date) {\n\t\tlet minDate = new Date(moment().subtract(1, 'week').calendar());\n\t\treturn new Date(date) < minDate ? moment(date).format('LLL') : moment(date).fromNow();\n\t};\n\n\n\tfunction onInit() {\n\t\t$scope.getProducts();\n\t}\n\n\tonInit();\n}]);\nangular.module('test').directive('whenScrollEnds', function() {\n    return {\n        restrict: \"A\",\n        link: function(scope, element, attrs) {\n            let visibleHeight = element.height(),\n                threshold = 1;\n\n            element.scroll(function(event) {\n                let scrollableHeight = element.prop('scrollHeight');\n                let hiddenContentHeight = scrollableHeight - visibleHeight;\n\n                if (hiddenContentHeight - element.scrollTop() <= threshold) {\n                    scope.$apply(attrs.whenScrollEnds);\n                }\n            });\n        }\n    };\n});"]}